- job:
    name: plugin-install
    project-type: freestyle
    description: |
      This is an integration test, part of Tier 1 test set.<br>
      It will install the plugin on Logstash. Logstash has different methods
      for installing a plugin:
      <ul>
        <li>script</li>
        <li>Gem</li>
      </ul>
    display-name: 'Plugin install test'
    concurrent: true
    node: docker-logstash
    scm:
      - logstash-input-bugzilla
    builders:
      - shell:
          !include-raw ../scripts/merge.sh
      - shell: |
          echo "====================="
          echo "Building a Gem file  "
          echo "====================="
          rvm jruby do gem build logstash-input-bugzilla.gemspec
          echo "====================="
          echo "Installing the plugin"
          echo "====================="
          rvm jruby do /opt/logstash/bin/plugin install "$(pwd)/logstash-input-example-*.gem"
          rvm jruby do /opt/logstash/bin/logstash -e 'input { bugzilla{} output {stdout { codec => rubydebug }}}'
